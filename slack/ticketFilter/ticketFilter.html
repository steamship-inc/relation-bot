<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <?!= include('slack/ticketFilter/ticketFilter_css') ?>
</head>
<body>
  <div id="municipalitySelectionModal" class="modal-content">
    <h2>🏛️ 自治体選択</h2>
    <p>フィルタ設定を行う自治体を選択してください</p>
    
    <div class="search-container">
      <input type="text" id="municipalitySearch" placeholder="自治体名で検索..." autocomplete="off">
    </div>
    
    <div class="municipality-list" id="municipalityList">
      <? for (var messageBoxId in configs) { ?>
        <div class="municipality-item" data-id="<?= messageBoxId ?>" onclick="selectMunicipality('<?= messageBoxId ?>')">
          <div class="municipality-name"><?= configs[messageBoxId].name ?></div>
          <div class="municipality-prefecture">都道府県: <?= configs[messageBoxId].prefecture ?></div>
        </div>
      <? } ?>
    </div>
    
    <div class="button-group">
      <button class="select-btn" id="selectButton" onclick="proceedToFilterConfig()" disabled>
        ✅ この自治体で設定する
      </button>
      <button class="cancel-btn" onclick="google.script.host.close()">
        ❌ キャンセル
      </button>
    </div>
  </div>

  <div id="filterConfigModal" class="modal-content" style="display: none;">
    <h2>🔧 Slackフィルタ設定</h2>
    <p><strong>自治体:</strong> <span id="selectedMunicipalityName"></span></p>
    
    <div class="section">
      <h3>🗂️ チケット分類フィルタ</h3>
      <div>
        <strong>通知対象分類（チェックした分類のチケットのみ通知します）:</strong>
        <div class="checkbox-group" id="includeCategories">
          <!-- 動的に生成 -->
        </div>
      </div>
    </div>
    
    <div class="section">
      <h3>🏷️ ラベルフィルタ</h3>
      <div>
        <strong>通知対象ラベル（チェックしたラベルのチケットのみ通知します）:</strong>
        <div class="checkbox-group" id="includeLabels">
          <!-- 動的に生成 -->
        </div>
      </div>
    </div>
    
    <div class="section">
      <h3>📋 設定プレビュー</h3>
      <div class="preview" id="configPreview"></div>
    </div>
    
    <div class="button-group">
      <button class="save-btn" onclick="saveConfig()">💾 保存</button>
      <button class="back-btn" onclick="goBackToMunicipalitySelection()">⬅️ 戻る</button>
      <button class="cancel-btn" onclick="google.script.host.close()">❌ キャンセル</button>
      <button onclick="clearAllFilters()">🗑️ フィルタクリア</button>
    </div>
  </div>

  <?!= include('slack/ticketFilter/ticketFilter_js') ?>
</body>
</html>
