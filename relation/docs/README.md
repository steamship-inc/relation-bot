# 全自治体向けre:lation連携システム

複数自治体のre:lationチケット情報を統合管理し、Slackに通知するシステムです。

## 設計方針

**基本コンセプト:**
- 1つのシートに全自治体分のopenチケットを集約
- 1つのシートに全自治体分のre:lation設定とSlack通知設定を集約
- エンジニアでなくても設定変更が容易
- 自治体横断的な残チケットメンテナンスを実現

## クイックスタート

### 1. 初回セットアップ
1. **APIキー設定**: スクリプトプロパティに`RELATION_API_KEY`と`SLACK_BOT_TOKEN`を設定
2. **受信箱取得**: 「📮受信箱取得」を実行して全自治体の基本情報を取得
3. **マスタデータ取得**: 「🏷️チケット分類取得」「🏷️ラベル取得」を実行
4. **設定調整**: 受信箱シートでSlackチャンネルなどの設定を編集

### 2. 日常運用
1. **全自治体一括取得**: 「🎫未対応チケット取得」を実行して最新チケット状況を取得
2. **統合シート確認**: 「🎫未対応チケット」シートで全自治体のチケット状況を確認
3. **横断的対応**: 自治体を跨いだチケット状況の把握・対応指示

### 3. 個別対応
1. **特定自治体通知**: 「🔔Slack手動送信」で緊急時に特定自治体のみにSlack通知
2. **マスタデータ更新**: 新しい分類やラベルが追加された場合に各取得機能を再実行
3. **設定変更**: 各自治体職員が受信箱シートでSlackチャンネル設定を直接編集

## メニュー構成

### 🟩 re:lation
- **🎫未対応チケット取得**: 全自治体のopenチケットを一括取得してシートに統合表示（Slack自動通知含む）
- **🔔Slack手動送信**: 選択した自治体に手動でSlack通知を送信（シートデータから抽出）
- **📮受信箱取得**: 全自治体のメッセージボックス情報を取得・受信箱シートを更新
- **🏷️チケット分類取得**: 全自治体のチケット分類情報を取得・チケット分類シートを更新
- **🏷️ラベル取得**: 全自治体のラベル情報を取得・ラベルシートを更新

## Slack通知内容

自治体ごとの専用チャンネルに以下の情報を通知：

- **自治体名**: 通知の識別
- **未対応チケット数**: 件数サマリー
- **最新5件の詳細**: ID、タイトル、作成日、更新日
- **直接リンク**: re:lationチケット画面への直リンク
- **スプレッドシート案内**: 詳細確認の案内

**通知例:**
```
🎫 山鹿市 - 未対応チケット状況報告

📊 未対応チケット数: 3件

📋 最新チケット（上位3件）:
• #12345 道路修繕要望
  作成: 07/28 09:00 | 更新: 07/29 15:30
• #12346 公園清掃依頼  
  作成: 07/29 10:15 | 更新: 07/29 10:15

💡 詳細はスプレッドシートをご確認ください
```

## システムの利点

### 統合管理による効率化
- **一元的チケット管理**: 全自治体のチケットを1つのシートで管理
- **横断的状況把握**: 自治体を跨いだチケット傾向・対応状況の把握
- **効率的メンテナンス**: 複数自治体の未対応チケットを同時に確認・指示

### 職員による直接運用
- **エンジニア不要**: 設定変更にプログラミング知識不要
- **即座の設定反映**: スプレッドシート編集で即座に検索条件変更
- **柔軟な運用**: 各自治体の特性に応じた独自設定

### スケーラビリティ
- **容易な自治体追加**: 新しい行追加のみで自治体追加
- **設定の標準化**: JSON形式での統一的な設定管理
- **将来拡張性**: 新しい検索条件項目の追加が容易

## ドキュメント構成

- [architecture.md](./architecture.md) - アーキテクチャとファイル構成
- [setup.md](./setup.md) - セットアップと初期設定
- [operation.md](./operation.md) - 運用ワークフローと操作手順
- [configuration.md](./configuration.md) - 設定ファイルの詳細
- [refactoring.md](./refactoring.md) - リファクタリング提案
